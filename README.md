# Sidecar Pattern Demonstration with Kubernetes

This project demonstrates the sidecar pattern using a Spring Boot `log-service` application and a `book-store` application, deployed together in a Kubernetes environment. The `log-service` acts as a sidecar to the `book-store`, collecting and processing its logs.

## Log Service

The `log-service` is a Spring Boot application designed to function as a sidecar. Its primary role is to collect, process, and manage logs generated by the main application (`book-store`). It accesses these logs via a shared volume within the Kubernetes pod. The source code for the `log-service` is available in the `log-service/` directory of this repository.

## Book Store Application (Main Application)

The `book-store` application serves as the main application in this demonstration. It generates logs that are then collected and processed by the `log-service` sidecar. 

**Note:** The source code for the `book-store` application is not included in this repository. It is deployed using a pre-built Docker image (`dorivalq/book-store:0.0.1`) as specified in the Kubernetes deployment configuration.

## Sidecar Pattern Implementation

This project utilizes the sidecar pattern by deploying the `book-store` and `log-service` containers together in the same Kubernetes pod. This is defined in the `sidecar-deployment.yaml` file.

Key aspects of this implementation:
*   **Shared Pod:** Both containers run within the `combined-service` pod. This allows them to share resources and network namespace.
*   **Shared Log Volume:** A volume named `log-volume` is mounted into both containers at the `/logs` path. The `book-store` application writes its logs to this directory, and the `log-service` reads from it, enabling log collection without direct integration into the main application's codebase.

## How to Run

1.  **Build the `log-service` Docker image:**
    Navigate to the `log-service/` directory and use the provided Dockerfile to build the image.
    ```bash
    cd log-service
    docker build -t your-dockerhub-username/log-service:latest . 
    # Or use the pre-built image: dorivalq/log-service
    cd ..
    ```
    *(Remember to replace `your-dockerhub-username/log-service:latest` with your actual image name if you build and push it, or update `sidecar-deployment.yaml` to use `dorivalq/log-service` if you haven't changed it).*

2.  **Deploy to Kubernetes:**
    Apply the Kubernetes manifest files to deploy the `combined-service` (which includes both `book-store` and `log-service`).
    ```bash
    kubectl apply -f sidecar-deployment.yaml
    kubectl apply -f sidecar-service.yaml
    ```

3.  **Access the Book Store Application:**
    The `book-store` application will be accessible via the NodePort defined in `sidecar-service.yaml`. Find the port by running:
    ```bash
    kubectl get svc combined-service
    ```
    Then access it at `http://<your-node-ip>:<node-port>`.

4.  **View Logs:**
    Logs from the `book-store` application will be written to the shared `/logs` volume. The `log-service` will process these logs. You can also inspect the logs by exec-ing into the containers if needed for debugging:
    ```bash
    # Find your pod name
    kubectl get pods
    # Exec into book-store container
    kubectl exec -it <your-pod-name> -c book-store -- /bin/sh 
    # Then check /logs directory, e.g., cat /logs/book-store.log

    # Exec into log-service container
    kubectl exec -it <your-pod-name> -c log-service -- /bin/sh
    # Then check /logs directory
    ```

## Log Access and Management

The `log-service` accesses logs written by the `book-store` application from the shared `/logs` directory within the pod. The primary log file is typically `book-store.log` (as seen in the `logs/` directory of this repository, which may contain an example or locally generated log output).

The `log-service` can be extended to perform various log management tasks, such as:
*   Log rotation
*   Sending logs to a centralized logging system (e.g., ELK stack, Splunk)
*   Generating alerts based on log patterns
